(()=>{class t{constructor(){this.audioContext=null,this.isPlayingMelody=!1,this.noteFrequencies={A:880,B:987.77,G:783.99,E:659.25},this.baseDuration=.5,this.noteDurations={halfDotted:1.5*this.baseDuration,eighth:this.baseDuration/2,sixteenth:this.baseDuration/4},this.melodySequence=[["A","halfDotted"],["B","eighth"],["A","sixteenth"],["G","sixteenth"],["E","halfDotted"],["G","sixteenth"],["A","sixteenth"]],this.init()}init(){document.addEventListener("click",()=>{this.audioContext||(this.audioContext=new(window.AudioContext||window.webkitAudioContext))},{once:!0}),this.setupEventListeners()}setupEventListeners(){document.querySelectorAll(".note-btn").forEach(t=>{t.addEventListener("click",t=>{this.audioContext||(this.audioContext=new(window.AudioContext||window.webkitAudioContext));const e=t.target.dataset.note;this.playSingleNote(e)})}),document.getElementById("playMelody").addEventListener("click",()=>{this.audioContext||(this.audioContext=new(window.AudioContext||window.webkitAudioContext)),this.playMelody()})}createOscillator(t){const e=this.audioContext.createOscillator(),i=this.audioContext.createGain();return e.type="sine",e.frequency.value=t,e.connect(i),i.connect(this.audioContext.destination),{oscillator:e,gainNode:i}}playSingleNote(t,e=.5){const i=this.noteFrequencies[t];if(!i)return;const{oscillator:n,gainNode:o}=this.createOscillator(i),a=this.audioContext.currentTime;o.gain.setValueAtTime(0,a),o.gain.linearRampToValueAtTime(1,a+.01),o.gain.exponentialRampToValueAtTime(.001,a+e),n.start(a),n.stop(a+e),this.updateStatus(`Играем ноту: ${this.getNoteName(t)}`)}async playMelody(){if(this.isPlayingMelody)return;this.isPlayingMelody=!0,this.updateStatus("Начинаем воспроизведение мелодии..."),this.setMelodyButtonState(!0);let t=this.audioContext.currentTime;const e=this.calculateTotalDuration();try{for(const[e,[i,n]]of this.melodySequence.entries()){const o=this.noteFrequencies[i],a=this.noteDurations[n];this.updateStatus(`Играем ноту ${e+1}: ${this.getNoteName(i)} (${this.getDurationName(n)})`);const{oscillator:s,gainNode:u}=this.createOscillator(o);u.gain.setValueAtTime(0,t),u.gain.linearRampToValueAtTime(1,t+.01),u.gain.exponentialRampToValueAtTime(.001,t+a),s.start(t),s.stop(t+a),t+=a}await new Promise(t=>{setTimeout(t,1e3*e+100)})}catch(t){console.error("Ошибка воспроизведения:",t),this.updateStatus("Ошибка воспроизведения")}finally{this.isPlayingMelody=!1,this.setMelodyButtonState(!1),this.updateStatus("Мелодия завершена")}}calculateTotalDuration(){return this.melodySequence.reduce((t,[,e])=>t+this.noteDurations[e],0)}getNoteName(t){return{A:"Ля",B:"Си",G:"Соль",E:"Ми"}[t]||t}getDurationName(t){return{halfDotted:"половинка с точкой",eighth:"восьмая",sixteenth:"шестнадцатая"}[t]||t}updateStatus(t){const e=document.getElementById("status");e&&(e.textContent=t)}setMelodyButtonState(t){const e=document.getElementById("playMelody");e&&(e.disabled=t,e.textContent=t?"🎼 Идет воспроизведение...":"🎼 Проиграть всю мелодию")}}document.addEventListener("DOMContentLoaded",()=>{new t})})();